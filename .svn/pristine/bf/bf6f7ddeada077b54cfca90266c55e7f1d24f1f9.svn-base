/******************************* **************************************************************
 通讯录联系人详情页, 省, 市,县无限级联动
 2014.07.28
 AeroJin 
 ***********************************************************************************************/
 ;
 (function ($, _, M139) {
    M139.namespace("M2012.Addr.Address", function (options) {

        var _this = this;

        this.container = options.container;
        this.dropWidth = options.dropWidth || 135;
        this.inputWidth = options.inputWidth || 268;
        this.defValue = options.defValue ? options.defValue : '__';

        this.TIP = { CITY: '城市'};

        this.result = {};
        this.result.provCode = options.provCode || '';
        this.result.cityCode = options.cityCode || '';
        this.result.address = options.address || '';     

        this.ui = {};        
        this.ui.container = $('<div class="addAddrCon"></div>');
        this.ui.input = $('<input type="text" class="iText mt_10" maxlength="50">');        

        this.init = function(){
            this.format();
            this.regDrop();
            this.regEvent();

            /*设置初始值*/
            this.ui.input.val(this.result.address);
            this.change(this.defValue, this.provDrop, this.result.provCode);
            this.change(this.provDrop.getSelectedItem().id, this.cityDrop, this.result.cityCode);

            /*填充UI*/
            this.container.html('');
            this.ui.input.width(this.inputWidth);
            this.ui.container.append(this.provDrop.$el);
            this.ui.container.append(this.cityDrop.$el);
            this.ui.container.append(this.ui.input);            
            this.ui.container.appendTo(this.container);
            
        };

        this.regDrop = function(){
            this.provOptions = {            
                maxHeight: 200,
                menuItems: [],
                container: $('<div></div>')
            };

            this.cityOptions = {            
                maxHeight: 200,
                menuItems: [],
                container: $('<div></div>')
            };

            this.cityDrop = M2012.UI.DropMenu.create(this.cityOptions);
            this.provDrop = M2012.UI.DropMenu.create(this.provOptions);

            this.provDrop.$el.width(this.dropWidth).addClass('fl');
            this.cityDrop.$el.width(this.dropWidth).addClass('fl ml_5');
        };

        this.regEvent = function(){        
            this.provDrop.on('change', function(item){          
                this.menu.remove();
                _this.cityDrop.setSelectedIndex(0);
                _this.change(item.id, _this.cityDrop);

                _this.result.provCode = item.text;
                _this.result.cityCode = _this.cityDrop.getSelectedItem().text;
            });

            this.cityDrop.on('change', function(item){
                this.menu.remove();
                _this.result.cityCode = item.text;          
            });

            this.ui.input.blur(function(){
                _this.result.address = $(this).val();
            });
        };

        this.change = function(pid, dropMenu, value){          
            var data = this.data[pid];
            var len = data.length;        
            var menuItems = dropMenu.options.menuItems;
            var index = pid == this.defValue ? len - 1 : 0;

            while(menuItems.length){
                menuItems.pop();
            }

            for(var i = 0; i < len; i++){
                dropMenu.addItem(data[i]);
            }

            if(value){
                dropMenu.setSelectedText(value);
            }else{
                dropMenu.setSelectedIndex(index);
            }
        };

        this.format = function(prev, current){
            this.data = {};
            var provLen = ProvinceArray.length;
            var cityLen = CityArray.length;

            for(var i = 0; i < provLen; i++){
                var parent = ProvinceArray[i];

                this.insertData({
                    id: parent[1],
                    text: parent[0],
                    value: parent[1],
                    other: parent[2],
                    pid: this.defValue                
                });
            };

           for(var j = 0; j < cityLen; j++){              
                var child = CityArray[j];

                this.insertData({
                  id: child[2],
                  text: child[0],
                  value: child[2],
                  pid: child[1],
                  other: child[3]
                });
            }

            this.insertData({
               id: '-1',
               text: this.TIP.CITY,
               value: '-1',
               pid: '-1',
               other: '86'             
            });

        };

        this.insertData = function(data){
            if(!this.data[data.pid]){
                this.data[data.pid] = [];
            }

            this.data[data.pid].push(data);
        };

        this.init();
    });
})(jQuery, _, M139);


//省份数组
var ProvinceArray=[['其他','0','86'],['北京','11','86'],['天津','12','86'],['河北','13','86'],['山西','14','86'],['内蒙古','15','86'],
                   ['辽宁','21','86'],['吉林','22','86'],['黑龙江','23','86'],['上海','31','86'],['江苏','32','86'],['浙江','33','86'],
                   ['安徽','34','86'],['福建','35','86'],['江西','36','86'],['山东','37','86'],['河南','41','86'],['湖北','42','86'],
                   ['湖南','43','86'],['广东','44','86'],['广西','45','86'],['海南','46','86'],['重庆','50','86'],['四川','51','86'],
                   ['贵州','52','86'],['云南','53','86'],['西藏','54','86'],['陕西','61','86'],['甘肃','62','86'],['青海','63','86'],
                   ['宁夏','64','86'],['新疆','65','86'],['省份','-1','86']];
//城市数组
var CityArray=[['其他','0','0','86'],
['北京','11','110000','86'],['东城区','11','110100','86'],['西城区','11','110200','86'],['崇文区','11','110300','86'],['宣武区','11','110400','86'],
['朝阳区','11','110500','86'],['海淀区','11','110600','86'],['丰台区','11','110700','86'],['石景山区','11','110800','86'],
['顺义区','11','110900','86'],['昌平区','11','111000','86'],['门头沟区','11','111100','86'],['通州区','11','111200','86'],['房山区','11','111300','86'],
['大兴区','11','111400','86'],['延庆县','11','111500','86'],['怀柔区','11','111600','86'],['平谷区','11','111700','86'],
['天津','12','120000','86'],
['石家庄','13','130100','86'],['唐山','13','130200','86'],['秦皇岛','13','130300','86'],['邯郸','13','130400','86'],['邢台','13','130500','86'],
['保定','13','130600','86'],['张家口','13','130700','86'],['承德','13','130800','86'],['沧州','13','130900','86'],['廊坊','13','131000','86'],['衡水','13','131100','86'],
['太原','14','140100','86'],['大同','14','140200','86'],['阳泉','14','140300','86'],['长治','14','140400','86'],['晋城','14','140500','86'],
['朔州','14','140600','86'],['忻州','14','142200','86'],['吕梁','14','142300','86'],['晋中','14','142400','86'],['临汾','14','142600','86'],['运城','14','142700','86'],
['呼和浩特','15','150100','86'],['包头','15','150200','86'],['乌海','15','150300','86'],['赤峰','15','150400','86'],['通辽','15','150500','86'],
['呼伦贝尔','15','152100','86'],['兴安盟','15','152200','86'],['乌兰浩特','15','152201','86'],['锡林郭勒','15','152500','86'],
['乌兰察布','15','152600','86'],['鄂尔多斯','15','152700','86'],['巴彦淖尔','15','152800','86'],['阿拉善','15','152900','86'],
['沈阳','21','210100','86'],['大连','21','210200','86'],['鞍山','21','210300','86'],['抚顺','21','210400','86'],['本溪','21','210500','86'],
['丹东','21','210600','86'],['锦州','21','210700','86'],['营口','21','210800','86'],['阜新','21','210900','86'],['辽阳','21','211000','86'],
['盘锦','21','211100','86'],['铁岭','21','211200','86'],['朝阳','21','211300','86'],['葫芦岛','21','211400','86'],
['长春','22','220100','86'],['吉林','22','220200','86'],['四平','22','220300','86'],['辽源','22','220400','86'],['通化','22','220500','86'],
['白山','22','220600','86'],['松原','22','220700','86'],['白城','22','220800','86'],['延边','22','222400','86'],
['哈尔滨','23','230100','86'],['齐齐哈尔','23','230200','86'],['鸡西','23','230300','86'],['鹤岗','23','230400','86'],['双鸭山','23','230500','86'],
['大庆','23','230600','86'],['伊春','23','230700','86'],['佳木斯','23','230800','86'],['七台河','23','230900','86'],['牡丹江','23','231000','86'],
['黑河','23','231100','86'],['绥化','23','232300','86'],['大兴安岭','23','232700','86'],
['上海','31','310000','86'],
['南京','32','320100','86'],['无锡','32','320200','86'],['徐州','32','320300','86'],['常州','32','320400','86'],['苏州','32','320500','86'],
['南通','32','320600','86'],['连云港','32','320700','86'],['淮安','32','320800','86'],['宿迁','32','320900','86'],['盐城','32','321000','86'],
['扬州','32','321100','86'],['泰州','32','321200','86'],['镇江','32','321300','86'],
['杭州','33','330100','86'],['宁波','33','330200','86'],['温州','33','330300','86'],['嘉兴','33','330400','86'],['湖州','33','330500','86'],
['绍兴','33','330600','86'],['金华','33','330700','86'],['永康','33','330784','86'],['衢州','33','330800','86'],['舟山','33','330900','86'],
['台州','33','331000','86'],['丽水','33','332500','86'],
['合肥','34','340100','86'],['芜湖','34','340200','86'],['蚌埠','34','340300','86'],['淮南','34','340400','86'],['马鞍山','34','340500','86'],
['淮北','34','340600','86'],['铜陵','34','340700','86'],['安庆','34','340800','86'],['黄山','34','341000','86'],['滁州','34','341100','86'],
['阜阳','34','341200','86'],['亳州','34','341300','86'],['宿州','34','342200','86'],['六安','34','342400','86'],['宣城','34','342500','86'],
['巢湖','34','342600','86'],['池州','34','342900','86'],
['福州','35','350100','86'],['厦门','35','350200','86'],['莆田','35','350300','86'],['三明','35','350400','86'],['泉州','35','350500','86'],
['南安','35','350583','86'],['漳州','35','350600','86'],['南平','35','350700','86'],['龙岩','35','350800','86'],['宁德','35','352200','86'],
['南昌','36','360100','86'],['景德镇','36','360200','86'],['萍乡','36','360300','86'],['九江','36','360400','86'],['新余','36','360500','86'],
['鹰潭','36','360600','86'],['赣州','36','362100','86'],['宜春','36','362200','86'],['上饶','36','362300','86'],['吉安','36','362400','86'],['抚州','36','362500','86'],
['济南','37','370100','86'],['青岛','37','370200','86'],['淄博','37','370300','86'],['枣庄','37','370400','86'],['东营','37','370500','86'],
['烟台','37','370600','86'],['潍坊','37','370700','86'],['济宁','37','370800','86'],['泰安','37','370900','86'],['威海','37','371000','86'],
['日照','37','371100','86'],['莱芜','37','371200','86'],['滨州','37','372300','86'],['德州','37','372400','86'],['聊城','37','372500','86'],
['临沂','37','372800','86'],['菏泽','37','372900','86'],
['郑州','41','410100','86'],['开封','41','410200','86'],['洛阳','41','410300','86'],['平顶山','41','410400','86'],['安阳','41','410500','86'],
['鹤壁','41','410600','86'],['新乡','41','410700','86'],['焦作','41','410800','86'],['濮阳','41','410900','86'],['许昌','41','411000','86'],
['漯河','41','411100','86'],['三门峡','41','411200','86'],['济源','41','411300','86'],['南阳','41','411400','86'],['商丘','41','412300','86'],
['周口','41','412700','86'],['驻马店','41','412800','86'],['信阳','41','413000','86'],
['武汉','42','420100','86'],['黄石','42','420200','86'],['十堰','42','420300','86'],['宜昌','42','420500','86'],['襄樊','42','420600','86'],
['鄂州','42','420700','86'],['荆门','42','420800','86'],['孝感','42','420900','86'],['黄冈','42','421000','86'],['荆州','42','421100','86'],
['天门','42','421200','86'],['仙桃','42','421300','86'],['潜江','42','421400','86'],['随州','42','421500','86'],['咸宁','42','422300','86'],['恩施','42','422800','86'],
['长沙','43','430100','86'],['株洲','43','430200','86'],['湘潭','43','430300','86'],['衡阳','43','430400','86'],['邵阳','43','430500','86'],
['岳阳','43','430600','86'],['常德','43','430700','86'],['张家界','43','430800','86'],['益阳','43','430900','86'],['郴州','43','431000','86'],
['永州','43','431100','86'],['怀化','43','431200','86'],['娄底','43','431300','86'],['湘西','43','433100','86'],
['广州','44','440100','86'],['韶关','44','440200','86'],['深圳','44','440300','86'],['珠海','44','440400','86'],['汕头','44','440500','86'],
['佛山','44','440600','86'],['江门','44','440700','86'],['湛江','44','440800','86'],['茂名','44','440900','86'],['肇庆','44','441200','86'],
['惠州','44','441300','86'],['梅州','44','441400','86'],['汕尾','44','441500','86'],['河源','44','441600','86'],['阳江','44','441700','86'],
['清远','44','441800','86'],['东莞','44','441900','86'],['中山','44','442000','86'],['云浮','44','442100','86'],['潮州','44','445100','86'],['揭阳','44','445200','86'],
['南宁','45','450100','86'],['柳州','45','450200','86'],['桂林','45','450300','86'],['梧州','45','450400','86'],['北海','45','450500','86'],
['防城港','45','450600','86'],['贵港','45','450700','86'],['玉林','45','450800','86'],['钦州','45','450900','86'],['崇左','45','452100','86'],
['来宾','45','452200','86'],['贺州','45','452400','86'],['百色','45','452600','86'],['河池','45','452700','86'],
['海口','46','460100','86'],['三亚','46','460200','86'],['儋州','46','460300','86'],
['重庆','50','500000','86'],
['成都','51','510100','86'],['自贡','51','510300','86'],['攀枝花','51','510400','86'],['泸州','51','510500','86'],['德阳','51','510600','86'],
['绵阳','51','510700','86'],['广元','51','510800','86'],['遂宁','51','510900','86'],['内江','51','511000','86'],['乐山','51','511100','86'],
['南充','51','511300','86'],['广安','51','511500','86'],['眉山','51','512100','86'],['宜宾','51','512500','86'],['达州','51','513000','86'],
['雅安','51','513100','86'],['阿坝','51','513200','86'],['甘孜','51','513300','86'],['凉山','51','513400','86'],['巴中','51','513700','86'],['资阳','51','513800','86'],
['贵阳','52','520100','86'],['六盘水','52','520200','86'],['遵义','52','522100','86'],['铜仁','52','522200','86'],['黔西南','52','522300','86'],
['毕节','52','522400','86'],['安顺','52','522500','86'],['黔东南','52','522600','86'],['黔南','52','522700','86'],
['昆明','53','530100','86'],['昭通','53','532100','86'],['曲靖','53','532200','86'],['楚雄','53','532300','86'],['玉溪','53','532400','86'],
['红河','53','532500','86'],['文山','53','532600','86'],['思茅','53','532700','86'],['西双版纳','53','532800','86'],['大理','53','532900','86'],
['保山','53','533000','86'],['德宏','53','533100','86'],['丽江','53','533200','86'],['怒江','53','533300','86'],['迪庆','53','533400','86'],['临沧','53','533500','86'],
['拉萨','54','540100','86'],['昌都','54','542100','86'],['山南','54','542200','86'],['日喀则','54','542300','86'],['那曲','54','542400','86'],
['阿里','54','542500','86'],['林芝','54','542600','86'],
['西安','61','610100','86'],['铜川','61','610200','86'],['宝鸡','61','610300','86'],['咸阳','61','610400','86'],['渭南','61','612100','86'],
['汉中','61','612300','86'],['安康','61','612400','86'],['商洛','61','612500','86'],['延安','61','612600','86'],['榆林','61','612700','86'],
['兰州','62','620100','86'],['嘉峪关','62','620200','86'],['金昌','62','620300','86'],['白银','62','620400','86'],['天水','62','620500','86'],
['酒泉','62','622100','86'],['张掖','62','622200','86'],['武威','62','622300','86'],['定西','62','622400','86'],['陇南','62','622600','86'],
['平凉','62','622700','86'],['庆阳','62','622800','86'],['临夏','62','622900','86'],['甘南','62','623000','86'],
['西宁','63','630100','86'],['海东','63','632100','86'],['海北','63','632200','86'],['黄南','63','632300','86'],['海南','63','632500','86'],
['果洛','63','632600','86'],['玉树','63','632700','86'],['海西','63','632800','86'],
['银川','64','640100','86'],['石嘴山','64','640200','86'],['吴忠','64','642100','86'],['固原','64','642200','86'],['中卫','64','642300','86'],
['乌鲁木齐','65','650100','86'],['克拉玛依','65','650200','86'],['石河子','65','650300','86'],['阿拉尔','65','650400','86'],['图木舒克','65','650500','86'],
['五家渠','65','650600','86'],['吐鲁番','65','652100','86'],['哈密','65','652200','86'],['昌吉','65','652300','86'],['博尔塔拉','65','652700','86'],
['巴音郭楞蒙','65','652800','86'],['阿克苏','65','652900','86'],['克州','65','653000','86'],['喀什','65','653100','86'],['和田','65','653200','86'],
['伊犁','65','654100','86'],['塔城','65','654200','86'],['阿勒泰','65','654300','86']];