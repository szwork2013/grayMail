<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
    <link rel="stylesheet" type="text/css" />
    <title>中国移动139邮箱</title>
    <style type="text/css">
        label {
            margin-top: 10px;
        }

        .privatesetwrap {
            padding-left: 20px;
        }

        .privateli li label {
            height: 25px;
            line-height: 25px;
            display: inline-block;
            vertical-align: middle;
            margin-top: 0;
        }

            .privateli li label input {
                vertical-align: middle;
            }

        .privateset h4 {
            font-weight: bold;
            border-bottom: 1px dashed #b1b1b1;
        }

        .privateset a {
            text-decoration: none;
        }

            .privateset a:hover {
                text-decoration: underline;
            }

        /*.privateset ul {
            padding: 5px 0 10px 0;
        }*/

        #pageSetBase .privateset li label {
            height: 23px;
            line-height: 23px;
            display: inline-block;
            width: 115px;
            margin-top: 0;
        }

        .pb_10 {
            padding-bottom: 10px;
        }
    </style>
    <script type="text/javascript">
        document.domain = window.location.host.match(/([^.]+\.[^.:]+):?\d*$/)[1];
        function filltag(d, c, f) { var b, a, e = []; while (d.length) { a = d.shift(); switch (true) { case Object.prototype.toString.apply(a) === "[object Array]": b = "<script " + (a[1].length > 0 ? 'charset="' + a[1] + '" ' : "") + "src='" + (a[2] ? a[2] : c) + "/js/" + a[0] + "' type='text/javascript'><\/script>"; break; case a.indexOf(".js") > -1: b = "<script " + (f ? 'charset="' + f + '" ' : "") + "src='" + c + "/js/" + a + "' type='text/javascript'><\/script>"; break; case a.indexOf(".css") > -1: b = "<link rel='stylesheet' type='text/css' href='" + c + "/css/" + a + "' />"; break; case a.length == 0: b = "<link rel='stylesheet' type='text/css' />" } e.push(b) } document.write(e.join("")) }

        var resourcePath = top.$App.getResourcePath(), addrsrc = resourcePath.replace('richmail', 'addr'), resourcePath = resourcePath.replace('richmail', 'coremail'), verifyImageUrl = '', AddressBookType = {}, g = 'GB2312';
        filltag(['global.css?v=20130801', 'addr.css'], resourcePath);

        try {
            top.loadScript("libs.pack.js", document);
            top.loadScript('m139.core.pack.js', document);
            top.loadScript("m2012.ui.common.pack.js", document);
            top.loadScript("m2011.utilscontrols.pack.js", document); //loadSkinCss
            top.loadScript("/m2012/js/packs/addr/addr_zh_hans.pack.js", document);
        } catch (ex) { }
    </script>
    <base target="_self" />
</head>
<body>
    <div id="pageSetBase">
        <div class="content">
            <div class="singTitle">
                <h4>
                    <strong><span>隐私设置</span></strong> | <a id="gotoHome" href="javascript:void(0);">&lt;&lt;返回</a>
                </h4>
            </div>
            <!--
            <h2><i></i><span class="navSet"><a id="gotoHome" href="javascript:void(0);">通讯录</a>&gt;&gt;</span>隐私设置</h2>-->
            <div id="divWhoWantAddMeHid" class="add-set">
                <div class="formArea">
                    <form name="rdForm" id="rdForm">
                        <div style="width: 288px;">当有人通过“你可能认识的人”将我添加为联系人时：</div>
                        <label for="agreement">
                            <input name="radioSet" type="radio" id="agreement" value="1" checked="checked" />总是同意</label>
                        <label for="ask">
                            <input name="radioSet" type="radio" id="ask" value="0" />总是询问我</label>
                        <label for="ignore">
                            <input name="radioSet" type="radio" id="ignore" value="2" />总是忽略</label>
                    </form>
                </div>
                <p style="margin-left:10px;">设置谁可以查看我的个人资料：<span class="gray">(好友即互为通讯录里的联系人)</span></p>
                <div class="formArea privateset" id="privateSet">
                    <h4 style="display:none">基本资料</h4>
                    <ul style="display:none">
                        <li>
                            <label>姓名</label>
                            <select id="AddrFirstName">
                                <option value="1">所有人可见</option>
                                <option selected value="0">仅好友可见</option>
                                <option value="2">仅自己可见</option>
                            </select>
                        </li>
                        <li>
                            <label>性别</label>
                            <select id="UserSex">
                                <option value="1">所有人可见</option>
                                <option selected value="0">仅好友可见</option>
                                <option value="2">仅自己可见</option>
                            </select>
                        </li>
                        <li>
                            <label>头像</label>
                            <select id="ImageUrl">
                                <option value="1">所有人可见</option>
                                <option selected value="0">仅好友可见</option>
                                <option value="2">仅自己可见</option>
                            </select>
                        </li>
                    </ul>
                    <h4 style="display:none;">联系方式</h4>
                    <ul>
                        <li>
                            <label>电子邮箱</label>
                            <select id="FamilyEmail">
                                <option value="1">所有人可见</option>
                                <option selected value="0">仅好友可见</option>
                                <option value="2">仅自己可见</option>
                            </select>
                        </li>
                        <li>
                            <label>商务邮箱</label>
                            <select id="BusinessEmail">
                                <option value="1">所有人可见</option>
                                <option selected value="0">仅好友可见</option>
                                <option value="2">仅自己可见</option>
                            </select>
                        </li>
                        <li>
                            <label>手机号码</label>
                            <select id="MobilePhone">
                                <option value="1">所有人可见</option>
                                <option selected value="0">仅好友可见</option>
                                <option value="2">仅自己可见</option>
                            </select>
                        </li>
                        <li>
                            <label>商务手机</label>
                            <select id="BusinessMobile">
                                <option value="1">所有人可见</option>
                                <option selected value="0">仅好友可见</option>
                                <option value="2">仅自己可见</option>
                            </select>
                        </li>
                        <li>
                            <label>生日</label>
                            <select id="BirDay">
                                <option value="1">所有人可见</option>
                                <option selected value="0">仅好友可见</option>
                                <option value="2">仅自己可见</option>
                            </select>
                        </li>
                        <li style="display:none">
                            <label>电话</label>
                            <select id="FamilyPhone">
                                <option value="1">所有人可见</option>
                                <option selected value="0">仅好友可见</option>
                                <option value="2">仅自己可见</option>
                            </select>
                        </li>
                        <li style="display:none">
                            <label>飞信号码</label>
                            <select id="OtherIm">
                                <option value="1">所有人可见</option>
                                <option selected value="0">仅好友可见</option>
                                <option value="2">仅自己可见</option>
                            </select>
                        </li>
                        <li style="display:none">
                            <label>通讯地址</label>
                            <select id="HomeAddress">
                                <option value="1">所有人可见</option>
                                <option selected value="0">仅好友可见</option>
                                <option value="2">仅自己可见</option>
                            </select>
                        </li>
                    </ul>
                    <h4 style="display:none">商务信息</h4>
                    <ul style="display:none">
                        <li>
                            <label>公司名称</label>
                            <select id="CPName">
                                <option value="1">所有人可见</option>
                                <option selected value="0">仅好友可见</option>
                                <option value="2">仅自己可见</option>
                            </select>
                        </li>
                        <li>
                            <label>职务</label>
                            <select id="UserJob">
                                <option value="1">所有人可见</option>
                                <option selected value="0">仅好友可见</option>
                                <option value="2">仅自己可见</option>
                            </select>
                        </li>
                        <li>
                            <label>商务邮箱</label>
                            <select id="BusinessEmail">
                                <option value="1">所有人可见</option>
                                <option selected value="0">仅好友可见</option>
                                <option value="2">仅自己可见</option>
                            </select>
                        </li>
                        <li>
                            <label>商务手机</label>
                            <select id="BusinessMobile">
                                <option value="1">所有人可见</option>
                                <option selected value="0">仅好友可见</option>
                                <option value="2">仅自己可见</option>
                            </select>
                        </li>
                        <li>
                            <label>公司固话</label>
                            <select id="BusinessPhone">
                                <option value="1">所有人可见</option>
                                <option selected value="0">仅好友可见</option>
                                <option value="2">仅自己可见</option>
                            </select>
                        </li>
                        <li>
                            <label>公司地址</label>
                            <select id="CPAddress">
                                <option value="1">所有人可见</option>
                                <option selected value="0">仅好友可见</option>
                                <option value="2">仅自己可见</option>
                            </select>
                        </li>
                        <li>
                            <label>公司邮编</label>
                            <select id="CPZipCode">
                                <option value="1">所有人可见</option>
                                <option selected value="0">仅好友可见</option>
                                <option value="2">仅自己可见</option>
                            </select>
                        </li>
                    </ul>

                    <p style="margin:10px 0 0 15px;"><a href="javascript:void(0);" id="privateReset">恢复默认设置</a></p>
                </div>
                <p class="action" style="margin-left:10px;">
                    <a href="javascript:;" id="btnSetOk" role="button" hidefocus="" class="btn btnGreen" style="margin-right:10px;"><em>保 存</em></a><a href="javascript:;" id="btnSetCancel" role="button" hidefocus="" class="btn ml_10"><em>取 消</em></a>
                </p>
            </div>
        </div>
    </div>
</body>
<script>
    Utils.setDomain();
    //Utils.loadSkinCss();
    var fileds = ["AddrFirstName", "UserSex", "BirDay", "ImageUrl", "FamilyEmail",
                  "MobilePhone", "FamilyPhone", "OtherIm", "HomeAddress", "CPName",
                  "UserJob", "BusinessEmail", "BusinessMobile", "BusinessPhone", "CPAddress", "CPZipCode"];
    var PageMsg = {
        'info_savesuccess': '设置成功！',
        'fail_setting': '设置失败！',
        'get_settingfail': '隐私设置获取失败'
    };
    var DEFAULT_PRIVACY = 0; //默认设置（仅好友可见)
    //JSON
    function StringToJson(res) {
        var obj = false;
        if (!res) {
            return obj;
        }
        if (window.JSON && JSON.parse) {
            try {
                obj = JSON.parse(res); //IE6不支持JSON，会使用M139.JSON.parse，间接引用jq.parseJSON
            } catch (ex) {
                try {
                    obj = eval("(" + res + ")");
                }
                catch (e) {
                    top.ScriptErrorLog &&
                    top.ScriptErrorLog.addLog &&
                    top.ScriptErrorLog.addLog("WARNPrivacySettings ", "json parse error|" + res);
                }
            }
        } else {
            obj = eval("(" + res + ")");
        }
        return obj;
    }
    //设置查询
    function initSetPrivatePage() {
        var params = '<GetPrivacySettings><UserNumber>' + top.$User.getUid() + '</UserNumber></GetPrivacySettings>';//<ConfigId>600</ConfigId> 已在后台写死
        var callback = function (response) {
            var data = StringToJson(response);
            if (!data || data.ResultCode != 0) {
                //可增加日志
                top.FF.alert(PageMsg["get_settingfail"]);
                //top.ScriptErrorLog.addLog("隐私设置获取失败" + response);
                logger("GetPrivacySettings", response, "隐私设置获取失败");
                return false;
            }

            //设置可能认识的人
            var whoaddemeset = data.WhoAddMeSetting;
            if (whoaddemeset) {
                $("input[name='radioSet'][value='" + whoaddemeset + "']").attr("checked", "true");
            }

            //设置隐私字段
            var privatesets = data.UserInfoSetting;
            for (var i = 0; i < fileds.length; i++) {
                //$("#" + fileds[i]).find("option[value='" + privatesets[fileds[i]] + "']").attr("selected", "selected").siblings().attr("selected", "");
                var selector = $("#" + fileds[i]);
                selector.find("option").removeAttr("selected");
                selector.val(privatesets[fileds[i]]);
            }
        };

        var reqData = {
            requestData: params,
            callback: callback
        };
        top.Contacts.getPrivacySettings(reqData);
    }

    //提交设置
    function setSubmit() {
        var addmeconfigValue = $("input[name='radioSet']:checked").val();
        switch (addmeconfigValue) {
            case "0":
                top.addBehavior("隐私设置", 1);
                break;
            case "1":
                top.addBehavior("隐私设置", 0);
                break;
            case "2":
                top.addBehavior("隐私设置", 2);
                break;
        }
        var privatesData = {};
        for (var i = 0; i < fileds.length; i++) {
            var val = $("#" + fileds[i]).val();
            privatesData[fileds[i]] = val ? val : 0;
        }
        var params = [];
        params.push('<SavePrivacySettings>');
        params.push('<UserNumber>');
        params.push(top.UserData.userNumber);
        params.push('</UserNumber>');
        params.push('<WhoAddMeSetting>');
        params.push(addmeconfigValue);
        params.push('</WhoAddMeSetting>');
        params.push('<UserInfoSetting>');
        params.push('<AddrFirstName>');
        params.push(privatesData["AddrFirstName"]);
        params.push('</AddrFirstName>');
        params.push('<UserSex>');
        params.push(privatesData["UserSex"]);
        params.push('</UserSex>');
        params.push('<BirDay>');
        params.push(privatesData["BirDay"]);
        params.push('</BirDay>');
        params.push('<ImageUrl>');
        params.push(privatesData["ImageUrl"]);
        params.push('</ImageUrl>');
        params.push('<FamilyEmail>');
        params.push(privatesData["FamilyEmail"]);
        params.push('</FamilyEmail>');
        params.push('<MobilePhone>');
        params.push(privatesData["MobilePhone"]);
        params.push('</MobilePhone>');
        params.push('<FamilyPhone>');
        params.push(privatesData["FamilyPhone"]);
        params.push('</FamilyPhone>');
        params.push('<OtherIm>');
        params.push(privatesData["OtherIm"]);
        params.push('</OtherIm>');
        params.push('<HomeAddress>');
        params.push(privatesData["HomeAddress"]);
        params.push('</HomeAddress>');
        params.push('<CPName>');
        params.push(privatesData["CPName"]);
        params.push('</CPName>');
        params.push('<UserJob>');
        params.push(privatesData["UserJob"]);
        params.push('</UserJob>');
        params.push('<BusinessEmail>');
        params.push(privatesData["BusinessEmail"]);
        params.push('</BusinessEmail>');
        params.push('<BusinessMobile>');
        params.push(privatesData["BusinessMobile"]);
        params.push('</BusinessMobile>');
        params.push('<BusinessPhone>');
        params.push(privatesData["BusinessPhone"]);
        params.push('</BusinessPhone>');
        params.push('<CPAddress>');
        params.push(privatesData["CPAddress"]);
        params.push('</CPAddress>');
        params.push('<CPZipCode>');
        params.push(privatesData["CPZipCode"]);
        params.push('</CPZipCode>');
        params.push('</UserInfoSetting>');
        params.push('</SavePrivacySettings>');
        params = params.join('');
        var callback = function (response) {
            var data = StringToJson(response);
            if (data && data.ResultCode != 0) {
                top.FF.alert(PageMsg["fail_setting"]);
                logger("GetPrivacySettings", response, "隐私设置获取失败");
                return false;
            }
            top.FF.alert(PageMsg["info_savesuccess"]);
        };

        var reqData = {
            requestData: params,
            callback: callback
        };
        top.Contacts.savePrivacySettings(reqData);
    }

    //上报日志
    function logger(api,response,msg) {
        var contactsApi = top.Contacts;
        if (contactsApi && contactsApi._reportLog) {
            contactsApi._reportLog({
                url: api,
                responseText: response,
                msg: msg
            });
        }
    }

    $(function () {
        //页面初始化
        initSetPrivatePage();

        $("#btnSetOk").click(function () {
            setSubmit();
        });

        $("#btnSetCancel,#gotoHome").click(function () {
            setTimeout(function() {
                if(top.$Addr){                
                    var master = top.$Addr;
                    master.trigger(master.EVENTS.LOAD_MAIN);
                }else{
					top.$('#addr').attr({'src': 'addr_v2/addr_index.html'});
				}
            }, 0xff);
        });



        //恢复默认设置
        $("#privateReset").click(function () {
            var selectEls = $("#privateSet select");
            $.each(selectEls, function (k, v) {
                //$(this).find(":eq(1)").attr("selected", "selected").siblings().attr("selected", "");
                var selector = $(this);
                selector.find("option").removeAttr("selected");
                selector.val(DEFAULT_PRIVACY);
            });
        });

        top.BH('addr_pageLoad_privacy');
    });
</script>
</html>
